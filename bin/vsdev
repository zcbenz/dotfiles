#!/usr/bin/bash

# Run following command in cygwin to add envs of vs dev:
# source `which vsdev`

query_vcvarsall() {
  (cd '/cygdrive/c/Program Files/Microsoft Visual Studio/2022/Community/Common7/Tools/' &&
   cmd /c "VsDevCmd.bat -no_logo && c:/cygwin/bin/bash -c printenv")
}

while IFS= read -r line; do
  key=$(echo $line | cut -d '=' -f 1)
  value=$(echo $line | cut -d '=' -f 2-)
  if [[ $key == *'('* ]] || [[ $key == *'!'* ]]; then
    continue
  fi
  export "$key=$value"
done <<< "$(query_vcvarsall)"

cd -
